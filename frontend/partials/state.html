<div ng-controller="StateController">
  <div class="inline-form">
    {{state.name}} - {{state.description}}<em ng-if="state.description == ''">Description needed</em>
    <a ng-repeat="inc in state.includes" ng-click="includes.removeState(inc.id)" class="btn btn-xs btn-warning">
      {{inc.name}}
      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
    </a>
    <span>
      <select ng-model="includes.stateId">
        <option ng-repeat="state in states" value="{{state.id}}">{{state.name}}</option>
      </select>
      <input type="button" value="Include" ng-click="includes.addState()">
    </span>
  </div>

  <!-- This controller up here is dumb, but there's not "one element" for it below. -->
  <!-- Probably end up with vastly different markup anyhow. -->
  <dl class="dl-horizontal" ng-controller="AddCommandController">
    <dt></dt><dd><input type="button"value="Add Command" ng-if="!addCommandVisible" ng-click="showAddCommand()"></dd>
    <dt ng-if="addCommandVisible">
      <input type="hidden" ng-model="c.methodType">
      <input type="text" ng-model="c.method">
    </dt>
    <dd ng-if="addCommandVisible">
      <div class="inline-form">
        <input type="text" ng-model="c.desc">
        <select ng-model="c.resultStateId">
          <option value="">- New -</option>
          <option ng-repeat="state in states" value="{{state.id}}">{{state.name}}</option>
        </select>
        <input type="text" ng-disabled="c.resultStateId != ''" ng-model="c.stateName">
        <!-- - <input type="text" ng-disabled="c.resultStateId != ''" ng-model="c.stateDesc">  -->
        <input type="button" value="Create" ng-click="createCommand()">
        <input type="button" value="Cancel" ng-click="hideAddCommand()">
      </div>
    </dd>
    <dt ng-repeat-start="command in state.commands">
      {{command.method}}
      <span ng-if="!!command.process" class="glyphicon glyphicon-star" aria-hidden="true"></span>
    </dt>
    <dd ng-repeat-end ng-controller="CommandController">
      <input ng-disabled="stateInStack" type="checkbox" ng-model="expandResultState">
      <a href="#" ng-click="addRootState(stateId)" title="Follow separately"><span class="glyphicon glyphicon-circle-arrow-down" aria-hidden="true"></span></a>
      <a ng-click="deleteCommand()" title="Delete command" class="btn btn-xs btn-danger">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </a>
      <a ng-click="removeCommand()" title="Remove command from process" class="btn btn-xs btn-warning">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
      </a>

      {{command.description}}
      <div ng-if="command.resultStateId && expandResultState" ng-include="'partials/state.html'">
        
      </div>
    </dd>
  </dl>
</div>
